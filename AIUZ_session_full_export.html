<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>AIUZ Session Full Export v2 — build ZIP</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body{font-family:system-ui,Arial,sans-serif;margin:0;background:#f3f6fb;color:#1a202c}
    header{background:#2c5282;color:#fff;padding:20px}
    main{max-width:1000px;margin:30px auto;padding:20px}
    pre{background:#1a202c;color:#e2e8f0;padding:15px;border-radius:8px;overflow:auto}
    .btn{padding:10px 16px;border:none;border-radius:8px;background:#3182ce;color:#fff;cursor:pointer;margin-right:10px}
    .muted{color:#718096;font-size:14px}
    .fileslist{margin-top:10px}
    li{margin-bottom:4px}
    footer{margin-top:30px;color:#718096;font-size:13px;text-align:center}
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
</head>
<body>
<header>
  <h1>AIUZ Session Full Export v2</h1>
  <div class="muted">Добавлена полная LaTeX монография + автопакеты грантовых схем</div>
</header>
<main>
  <p>Сохраните этот файл как <code>AIUZ_session_full_export_v2.html</code>, затем откройте в браузере и нажмите <strong>Build & Download ZIP</strong>. ZIP будет содержать все артефакты, включая монографию и grant-модули.</p>
  <div>
    <button id="btnBuild" class="btn">Build & Download ZIP</button>
    <button id="btnList" class="btn" style="background:#2a69ac">Show file list</button>
    <span id="status" class="muted"></span>
  </div>

  <h3>Файлы, включаемые в ZIP</h3>
  <ul id="fileList" class="fileslist"></ul>

  <h3>Содержимое монографии и grant-механизмов (часть)</h3>
  <pre id="manifestPreview"></pre>

  <footer>Для добавления ещё материалов скажи «Добавь X», я обновлю HTML снова.</footer>
</main>

<script>
// Коллекция файлов для экспорта
const FILES = {
  "monograph/main.tex": `\\documentclass[12pt]{book}
\\usepackage[utf8]{inputenc}
\\title{Fractal Metascience: Theory & Practice}
\\author{AIUZ Collective}
\\date{2025-10-29}
\\begin{document}
\\maketitle
\\tableofcontents
\\input{chapters/01_foundations.tex}
\\input{chapters/02_formalism.tex}
\\input{chapters/03_platforms.tex}
\\input{chapters/04_cases.tex}
\\input{chapters/05_methods.tex}
\\input{chapters/06_implementation.tex}
\\end{document}`,

  "monograph/chapters/01_foundations.tex": `\\chapter{Foundations}
Современная наука ... (полный текст из сессии)`,
  "monograph/chapters/02_formalism.tex": `\\chapter{Formalism}
Определение FEU, композиция, invariants, pseudocode...`,
  "monograph/chapters/03_platforms.tex": `\\chapter{Platforms}
Описание NULLO PLT и UCOMM архитектуры...`,
  "monograph/chapters/04_cases.tex": `\\chapter{Case Studies}
Примеры: образование, умные города, узбек-майнинг...`,
  "monograph/chapters/05_methods.tex": `\\chapter{Methods}
Методы living labs, mixed methods, preregistration...`,
  "monograph/chapters/06_implementation.tex": `\\chapter{Implementation}
Код, API, CI/CD, упаковка артефактов...`,

  // Snippets текстовые (для демонстрации)
  "snippets/snippet1.txt": `Пример текстового сниппета: фрагмент главы или статьи...`,
  "snippets/snippet2.txt": `Еще один фрагмент текста: обзор, введение или обсуждение...`,

  // Grant механизмы: шаблон гранта Horizon (пример)
  "grant_templates/horizon_proposal.tex": `% Шаблон предложения для Horizon
\\documentclass[12pt]{article}
\\title{Project Title — Horizon Proposal}
\\author{Operator}
\\date{\\today}
\\begin{document}
\\maketitle
\\section{Excellence}
Описание научной инновации...
\\section{Impact}
Описание влияния...
\\section{Implementation}
Work packages, Gantt, deliverables...
\\section{Resources}
Personnel, budget, equipment...
\\end{document}`,

  "grant_templates/f6s_descriptor.jsonld": `{
  "@context":"https://schema.org",
  "@type":"Project",
  "name":"Sample F6S Project",
  "description":"Generated by AIUZ session",
  "identifier":"f6s-sample-2025"
}`,

  "grant_templates/unesco_template.docx": `Приложение: шаблон заявки UNESCO (DOCX placeholder)`,

  // скрипты автопакетов
  "scripts/grant_bundle.py": `#!/usr/bin/env python3
import os, json
# Скрипт формирует архив заявки + метаданные под выбранный фонд
print("Grant bundling script — допиши шаблоны фондов")`,

  "scripts/build_grant_package.js": `// Node.js script шаблон
const fs = require('fs');
console.log("Build grant package — placeholder from session");`,

  // уже существующие артефакты (статья1)
  "articles/article1_fmp_nullo.tex": `% (LaTeX article text из сессии)`,
  "code/server.js": `// Node API minimal (из сессии)`,
  "code/FractalNodePreview.jsx": `// React component (из сессии)`,
  "openapi/openapi.yaml": `openapi: 3.0.3 ...`,
  "Dockerfile": `# Dockerfile minimal node (из сессии)`,
  ".github/workflows/build_release.yml": `name: Build AIUZ Reworked Release ...`,
  "publish_checklist.md": `# Publish Checklist ... (из сессии)`,
  "README_SESSION_FULL.txt": `Полный экспорт сессии, включая монографию и автопакеты.`
};

// Render file list UI
const fileListEl = document.getElementById('fileList');
const manifestPreview = document.getElementById('manifestPreview');
const fns = Object.keys(FILES).sort();
fns.forEach(fn=>{
  const li = document.createElement('li');
  li.textContent = fn;
  fileListEl.appendChild(li);
});
manifestPreview.textContent = JSON.stringify(fns, null, 2);

// Build & download ZIP
document.getElementById('btnBuild').addEventListener('click', async ()=>{
  const zip = new JSZip();
  document.getElementById('status').textContent = 'Сбор ZIP…';
  for (let i=0;i<fns.length;i++){
    const fn = fns[i];
    const content = FILES[fn];
    zip.file(fn, content);
    document.getElementById('status').textContent = `Добавляю ${i+1}/${fns.length}: ${fn}`;
    await new Promise(r=>setTimeout(r, 10));
  }
  const blob = await zip.generateAsync({type:"blob", compression:"DEFLATE"});
  saveAs(blob, 'AIUZ_session_full_export_v2.zip');
  document.getElementById('status').textContent = 'Готово — ZIP загружается.';
});

// Show file list
document.getElementById('btnList').addEventListener('click', ()=>{
  alert(`Файлов: ${fns.length}. Список в консоли.`);
  console.log("Included files:", fns);
});
</script>
</body>
</html>
